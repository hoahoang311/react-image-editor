import _defineProperty from"@babel/runtime/helpers/defineProperty";import _toConsumableArray from"@babel/runtime/helpers/toConsumableArray";import _slicedToArray from"@babel/runtime/helpers/slicedToArray";function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}import React,{useMemo,useState,useEffect,useCallback}from"react";import{SET_CROP,SET_RESIZE,SHOW_MEASURE,ZOOM_CANVAS}from"../../../actions";import{usePhoneScreen,useStore}from"../../../hooks";import{StyledToolsBarItemButtonLabel}from"../../ToolsBar/ToolsBar.styled";import{DEFAULT_ZOOM_FACTOR,ORIGINAL_CROP,TABS_IDS,TOOLS_IDS}from"../../../utils/constants";import toPrecisedFloat,{fromIdOptionToCropPreset,getIdTypeFromName}from"../../../utils/toPrecisedFloat";import getZoomFitFactor from"../../../utils/getZoomFitFactor";import{MoveDownOutline,MoveUpOutline}from"@scaleflex/icons";import{DEFAULT_CROP_PRESETS}from"./Crop.constants";import CropPresetGroupsList from"./CropPresetGroupsFolder";import CropPresetItem from"./CropPresetItem";import{StyledOpenMenuButton,StyledMenu,StyledToolsBarItemButtonWrapper,StyledCropItems,StyledCustomCropItems,StyledApplyButton,StyledMeasureLabel,StyledMeasureSwitch,StyledCropMeasureContainer,StyledCountrySearchWrapper,StyledCountrySelectWrapper,StyledMenuItem,StyledCountryList,StyledMenuItemLabel}from"./Crop.styled";import{StyledCountryInput,StyledResizeInput}from"../Resize/Resize.styled";var CropPresetsOption=function(a){var b,c=a.anchorEl,d=a.onClose,e=a.isSelected,f=useStore(),g=f.dispatch,h=f.t,i=f.adjustments,j=void 0===i?{}:i,k=j.crop,l=void 0===k?{}:k,m=l.ratio,n=l.ratioTitleKey,o=l.ratioFolderKey,p=f.shownImageDimensions,q=f.showMeasure,r=f.config,s=f.theme,t=f.tabId,u=m||ORIGINAL_CROP,v=r[TOOLS_IDS.CROP],w=r.countries,x=r.setCountry,y=r.idOptions,z=r.setActiveId,A=useState([]),B=_slicedToArray(A,2),C=B[0],D=B[1],E=usePhoneScreen(),F=useState({w:null,h:null}),G=_slicedToArray(F,2),H=G[0],I=G[1],J=useState(),K=_slicedToArray(J,2),L=K[0],M=K[1],N=useState(null),O=_slicedToArray(N,2),P=O[0],Q=O[1],R=useMemo(function(){var a=v.lockCropAreaAt,b=a?DEFAULT_CROP_PRESETS.filter(function(b){var c;return!(null!==(c=b.hide)&&void 0!==c&&c.call(b,{lockCropAreaAt:a}))}):DEFAULT_CROP_PRESETS;return[].concat(_toConsumableArray(b),_toConsumableArray(fromIdOptionToCropPreset(C)))},[v,C]);useEffect(function(){null!==y&&void 0!==y&&y.length?D(y):D([])},[null===y||void 0===y||null===(b=y[0])||void 0===b?void 0:b.country]);var S=useCallback(function(a,b,c){a.stopPropagation();var e=getIdTypeFromName(C,c.ratioTitleKey);e&&z(e);var f={ratio:b,ratioTitleKey:c.ratioTitleKey,ratioGroupKey:c.ratioGroupKey,ratioFolderKey:c.ratioFolderKey,noEffect:c.noEffect};g({type:SET_CROP,payload:f}),v.autoResize&&(g({type:SET_RESIZE,payload:{width:c.width,height:c.height,manualChangeDisabled:c.disableManualResize}}),g({type:ZOOM_CANVAS,payload:{factor:c.width>p.width||c.height>p.height?getZoomFitFactor(p,c):DEFAULT_ZOOM_FACTOR}})),d()},[p,C,z]),T=function(a){var b=a.target,c=b.name,d=b.value;"width"===c?I(function(a){return _objectSpread(_objectSpread({},a),{},{w:d})}):I(function(a){return _objectSpread(_objectSpread({},a),{},{h:d})})},U=useCallback(function(a,b){var c=a.titleKey,d=a.descriptionKey,e=a.ratio,f=a.width,g=a.height,i=a.groups,j=a.icon,k=a.disableManualResize,l=a.noEffect;return i?React.createElement(CropPresetGroupsList,{key:c+b.toString(),titleKey:c,groups:i,Icon:j,theme:s,onItemSelect:S,t:h,disableManualResize:k}):React.createElement(CropPresetItem,{key:c+b.toString(),ratio:null!==e&&void 0!==e?e:toPrecisedFloat(f/g),titleKey:c,t:h,description:h(d),Icon:j,isActive:u===(null!==e&&void 0!==e?e:toPrecisedFloat(f/g))&&!o,theme:s,width:f,height:g,onClick:S,disableManualResize:k,noEffect:l})},[S,s,u,o]);useEffect(function(){(!e&&C.length||t!==TABS_IDS.RESIZE)&&(D([]),z(null))},[e]),useEffect(function(){(!e&&P||t!==TABS_IDS.RESIZE)&&x(null)},[e,P]);var V=useMemo(function(){return null!==L&&void 0!==L&&L.length&&null!==w&&void 0!==w&&w.length?w.filter(function(a){return a.toLowerCase().includes(L.toLowerCase())}):w},[w,L]);return React.createElement(React.Fragment,null,React.createElement(StyledToolsBarItemButtonWrapper,null,React.createElement(StyledToolsBarItemButtonLabel,{className:"FIE_crop-tool-label FIE_selected-crop-preset-label",isPhoneScreen:E},h(n||"cropTool")),React.createElement(StyledOpenMenuButton,{className:"FIE_crop-presets-opener-button",color:"link-secondary",size:"lg"},c?React.createElement(MoveUpOutline,{size:10}):React.createElement(MoveDownOutline,{size:10}))),c&&!(null!==C&&void 0!==C&&C.length)?React.createElement(StyledCountrySelectWrapper,{className:"FIE_crop-items"},React.createElement(StyledCountrySearchWrapper,{className:"FIE_crop-items"},React.createElement(StyledCountryInput,{className:"FIE_custom-crop",value:L,name:"country",onChange:function(a){var b=a.target.value;b.length?M(b):M(void 0)},size:"sm",placeholder:"Search country..."})),null!==V&&void 0!==V&&V.length?React.createElement(StyledCountryList,{className:"FIE_crop-items"},V.map(function(a){return React.createElement(StyledMenuItem,{active:a===P,onClick:function(){Q(a),null===x||void 0===x||x(a),z(null)},key:a},React.createElement(StyledMenuItemLabel,{size:"xl"},h(a)))})):null):null,c&&null!==C&&void 0!==C&&C.length&&P?React.createElement(StyledCropItems,{className:"FIE_crop-items-preset"},React.createElement(StyledMenu,{className:"FIE_crop_preset-wrapper"},R.map(U))):null,c&&null!==C&&void 0!==C&&C.length?React.createElement(StyledCustomCropItems,{className:"FIE_crop-items"},React.createElement(StyledResizeInput,{className:"FIE_custom-crop",value:H.w||0,name:"width",onChange:T,inputMode:"numeric",title:"W",label:"W",inputProps:{type:"number"},size:"sm",iconEnd:"",placeholder:"Width"}),React.createElement(StyledResizeInput,{className:"FIE_custom-crop",value:H.h||0,name:"height",onChange:T,inputMode:"numeric",title:"H",label:"H",inputProps:{type:"number"},size:"sm",iconEnd:"",placeholder:"Height"}),React.createElement(StyledApplyButton,{size:"sm",disabled:0>=H.w||0>=H.h,onClick:function(a){a.stopPropagation(),g({type:SET_CROP,payload:{ratio:toPrecisedFloat(H.w/H.h),ratioTitleKey:"Portrait (".concat(H.w,"x").concat(H.h,")"),ratioGroupKey:void 0,ratioFolderKey:void 0,noEffect:!1}}),d()}},"Apply")):null,c&&null!==C&&void 0!==C&&C.length?React.createElement(StyledCropMeasureContainer,{className:"FIE_crop-measurement"},React.createElement(StyledMeasureLabel,null,"Show measurements"),React.createElement(StyledMeasureSwitch,{size:"sm",color:"#186DE2",checked:q,onChange:function(){g({type:SHOW_MEASURE,payload:{enabled:!q}})}})):null)};CropPresetsOption.defaultProps={anchorEl:null,isSelected:!1};export default CropPresetsOption;