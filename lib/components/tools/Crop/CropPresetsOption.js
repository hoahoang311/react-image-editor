import _defineProperty from"@babel/runtime/helpers/defineProperty";import _toConsumableArray from"@babel/runtime/helpers/toConsumableArray";import _slicedToArray from"@babel/runtime/helpers/slicedToArray";function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}import React,{useMemo,useState,useEffect}from"react";import{SET_CROP,SET_RESIZE,SHOW_MEASURE,ZOOM_CANVAS}from"../../../actions";import{usePhoneScreen,useStore}from"../../../hooks";import{StyledToolsBarItemButtonLabel}from"../../ToolsBar/ToolsBar.styled";import{DEFAULT_ZOOM_FACTOR,ORIGINAL_CROP,TOOLS_IDS}from"../../../utils/constants";import toPrecisedFloat,{fromIdOptionToCropPreset}from"../../../utils/toPrecisedFloat";import getZoomFitFactor from"../../../utils/getZoomFitFactor";import{MoveDownOutline,MoveUpOutline}from"@scaleflex/icons";import{DEFAULT_CROP_PRESETS}from"./Crop.constants";import CropPresetGroupsList from"./CropPresetGroupsFolder";import CropPresetItem from"./CropPresetItem";import{StyledOpenMenuButton,StyledMenu,StyledToolsBarItemButtonWrapper,StyledCropItems,StyledCustomCropItems,StyledApplyButton,StyledMeasureLabel,StyledMeasureSwitch,StyledCropMeasureContainer,StyledCountrySearchWrapper,StyledCountrySelectWrapper,StyledMenuItem,StyledCountryList,StyledMenuItemLabel}from"./Crop.styled";import{StyledCountryInput,StyledResizeInput}from"../Resize/Resize.styled";var testCountry=["USA","Canada"],CropPresetsOption=function(a){var b=a.anchorEl,c=a.onClose,d=useStore(),f=d.dispatch,g=d.t,e=d.adjustments,h=void 0===e?{}:e,i=h.crop,j=void 0===i?{}:i,k=j.ratio,l=j.ratioTitleKey,m=j.ratioFolderKey,n=d.shownImageDimensions,o=d.showMeasure,p=d.config,q=d.theme,r=p[TOOLS_IDS.CROP],s=p.countries,t=void 0===s?testCountry:s,u=p.setCountry,v=p.idOptions,w=p.setIdPhoto,x=usePhoneScreen(),y=useState({w:null,h:null}),z=_slicedToArray(y,2),A=z[0],B=z[1],C=useState(),D=_slicedToArray(C,2),E=D[0],F=D[1],G=useState(null),H=_slicedToArray(G,2),I=H[0],J=H[1],K=useMemo(function(){var a=r.lockCropAreaAt,b=a?DEFAULT_CROP_PRESETS.filter(function(b){var c;return!(null!==(c=b.hide)&&void 0!==c&&c.call(b,{lockCropAreaAt:a}))}):DEFAULT_CROP_PRESETS;return[].concat(_toConsumableArray(b),_toConsumableArray(fromIdOptionToCropPreset(v)))},[r,v]),L=function(a,b,d){a.stopPropagation();var e={ratio:b,ratioTitleKey:d.ratioTitleKey,ratioGroupKey:d.ratioGroupKey,ratioFolderKey:d.ratioFolderKey,noEffect:d.noEffect};f({type:SET_CROP,payload:e}),r.autoResize&&(f({type:SET_RESIZE,payload:{width:d.width,height:d.height,manualChangeDisabled:d.disableManualResize}}),f({type:ZOOM_CANVAS,payload:{factor:d.width>n.width||d.height>n.height?getZoomFitFactor(n,d):DEFAULT_ZOOM_FACTOR}})),c()},M=function(a){var b=a.target,c=b.name,d=b.value;"width"===c?B(function(a){return _objectSpread(_objectSpread({},a),{},{w:d})}):B(function(a){return _objectSpread(_objectSpread({},a),{},{h:d})})};useEffect(function(){b||null!==u&&void 0!==u&&u(null)},[b]);var N=useMemo(function(){return null!==E&&void 0!==E&&E.length&&null!==t&&void 0!==t&&t.length?t.filter(function(a){return a.toLowerCase().includes(E.toLowerCase())}):t},[t,E]);return React.createElement(React.Fragment,null,React.createElement(StyledToolsBarItemButtonWrapper,null,React.createElement(StyledToolsBarItemButtonLabel,{className:"FIE_crop-tool-label FIE_selected-crop-preset-label",isPhoneScreen:x},g(l||"cropTool")),React.createElement(StyledOpenMenuButton,{className:"FIE_crop-presets-opener-button",color:"link-secondary",size:"lg"},b?React.createElement(MoveUpOutline,{size:10}):React.createElement(MoveDownOutline,{size:10}))),b&&!(null!==v&&void 0!==v&&v.length)&&React.createElement(StyledCountrySelectWrapper,{className:"FIE_crop-items"},React.createElement(StyledCountrySearchWrapper,{className:"FIE_crop-items"},React.createElement(StyledCountryInput,{className:"FIE_custom-crop",value:E,name:"country",onChange:function(a){var b=a.target.value;b.length?F(b):F(void 0)},size:"sm",placeholder:"Search country..."})),null!==N&&void 0!==N&&N.length?React.createElement(StyledCountryList,{className:"FIE_crop-items"},N.map(function(a){return React.createElement(StyledMenuItem,{active:a===I,onClick:function(){J(a),null===u||void 0===u||u(a)},key:a},React.createElement(StyledMenuItemLabel,{size:"xl"},g(a)))})):null),b&&(null===v||void 0===v?void 0:v.length)&&React.createElement(StyledCropItems,{className:"FIE_crop-items"},React.createElement(StyledMenu,null,K.map(function(a){var b=a.titleKey,c=a.descriptionKey,d=a.ratio,e=a.width,f=a.height,h=a.groups,i=a.icon,j=a.disableManualResize,l=a.noEffect;return h?React.createElement(CropPresetGroupsList,{key:b,titleKey:b,groups:h,Icon:i,theme:q,onItemSelect:L,t:g,disableManualResize:j}):React.createElement(CropPresetItem,{key:d,ratio:null!==d&&void 0!==d?d:toPrecisedFloat(e/f),titleKey:b,t:g,description:g(c),Icon:i,isActive:(k||ORIGINAL_CROP)===(null!==d&&void 0!==d?d:toPrecisedFloat(e/f))&&!m,theme:q,width:e,height:f,onClick:L,disableManualResize:j,noEffect:l})}))),b&&(null===v||void 0===v?void 0:v.length)&&React.createElement(StyledCustomCropItems,{className:"FIE_crop-items"},React.createElement(StyledResizeInput,{className:"FIE_custom-crop",value:A.w,name:"width",onChange:M,inputMode:"numeric",title:"W",label:"W",inputProps:{type:"number"},size:"sm",iconEnd:"",placeholder:"Width"}),React.createElement(StyledResizeInput,{className:"FIE_custom-crop",value:A.h,name:"height",onChange:M,inputMode:"numeric",title:"H",label:"H",inputProps:{type:"number"},size:"sm",iconEnd:"",placeholder:"Height"}),React.createElement(StyledApplyButton,{size:"sm",disabled:0>=A.w||0>=A.h,onClick:function(a){a.stopPropagation(),f({type:SET_CROP,payload:{ratio:toPrecisedFloat(A.w/A.h),ratioTitleKey:"Portrait (".concat(A.w,"x").concat(A.h,")"),ratioGroupKey:void 0,ratioFolderKey:void 0,noEffect:!1}}),c()}},"Apply")),b&&(null===v||void 0===v?void 0:v.length)&&React.createElement(StyledCropMeasureContainer,{className:"FIE_crop-measurement"},React.createElement(StyledMeasureLabel,null,"Show measurements"),React.createElement(StyledMeasureSwitch,{size:"sm",color:"#186DE2",checked:o,onChange:function(){f({type:SHOW_MEASURE,payload:{enabled:!o}})}})))};CropPresetsOption.defaultProps={anchorEl:null};export default CropPresetsOption;